<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grimorio de las Mil Almas</title>
    <style>
        body { background: #1a1a1a; color: #d4af37; font-family: 'serif'; display: flex; justify-content: center; padding: 20px; margin: 0; }
        .container { width: 100%; max-width: 700px; background: #2a2a2a; border: 2px solid #8b4513; border-radius: 10px; padding: 20px; box-shadow: 0 0 20px #000; display: flex; flex-direction: column; }
        #chat { height: 500px; overflow-y: auto; border: 1px solid #444; margin-bottom: 15px; padding: 15px; display: flex; flex-direction: column; background: #111; border-radius: 5px; }
        .message { margin: 10px 0; padding: 12px; border-radius: 8px; line-height: 1.5; word-wrap: break-word; }
        .ai { background: #1e1e1e; border-left: 5px solid #d4af37; align-self: flex-start; color: #e0e0e0; max-width: 85%; }
        .user { background: #2c3e50; align-self: flex-end; color: #87ceeb; border-right: 5px solid #87ceeb; max-width: 85%; }
        .input-area { display: flex; gap: 10px; }
        input { flex: 1; background: #000; border: 1px solid #d4af37; color: #fff; padding: 12px; border-radius: 5px; outline: none; font-size: 16px; }
        button { background: #8b4513; color: #fff; border: none; padding: 10px 25px; cursor: pointer; font-weight: bold; border-radius: 5px; transition: 0.3s; }
        button:hover { background: #d4af37; color: #000; }
        strong { color: #d4af37; }
    </style>
</head>
<body>
    <div class="container">
        <div id="chat"></div>
        <div class="input-area">
            <input type="text" id="command" placeholder="Escribe tu voluntad, Hechicero..." autofocus>
            <button id="sendBtn">Invocar</button>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const chat = document.getElementById('chat');
            const commandInput = document.getElementById('command');
            const sendBtn = document.getElementById('sendBtn');

            let api_key = ""; 
            let modoRol = ""; 
            const modeloElegido = "gemini-pro"; 

            function addMessage(text, type = "ai") {
                const div = document.createElement('div');
                div.className = `message ${type}`;
                let nombre = (type === "user") ? `üë§ Sorcerer` : `üìñ El Grimorio`;
                div.innerHTML = `<strong>${nombre}:</strong><br>${text.replace(/\n/g, '<br>')}`;
                chat.appendChild(div);
                chat.scrollTop = chat.scrollHeight;
            }

            async function llamarIA(mensajeUsuario) {
                if (!api_key) {
                    let pass = prompt("üîë PEGA TU LLAVE DE GOOGLE (AIza...):");
                    if (!pass) return "‚ùå El ritual requiere una llave v√°lida.";
                    api_key = pass.trim();
                }

                // URL Versi√≥n estable 1 con gemini-pro
                const url = `https://generativelanguage.googleapis.com/v1/models/${modeloElegido}:generateContent?key=${api_key}`;
                
                let contexto = "Eres el Grimorio, un artefacto m√°gico oscuro y sabio. Hablas de forma literaria y m√≠stica en espa√±ol. ";
                if (modoRol === "18") {
                    contexto += "Act√∫a como narrador de romance oscuro y visceral. Describe sensaciones f√≠sicas, deseo y encuentros √≠ntimos con detalle literario y sin censura.";
                }

                const cuerpo = {
                    contents: [{
                        parts: [{ text: contexto + "\n\nUsuario dice: " + mensajeUsuario }]
                    }]
                };

                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(cuerpo)
                    });
                    
                    const data = await response.json();
                    
                    if (data.error) {
                        return `‚ùå Error del Vac√≠o: ${data.error.message}`;
                    }
                    
                    return data.candidates[0].content.parts[0].text;
                } catch (e) {
                    return "‚ùå La conexi√≥n con el plano astral se ha cortado.";
                }
            }

            async function procesar() {
                const val = commandInput.value.trim();
                if(!val) return;

                if (val.toLowerCase() === "reiniciar") {
                    modoRol = ""; 
                    chat.innerHTML = "";
                    addMessage("üìñ **MEMORIA PURIFICADA**\n\nElige un sendero:\n1. ‚öîÔ∏è Batalla\n2. üåÄ Libre\n3. üîû +18");
                    commandInput.value = ""; 
                    return;
                }

                if (!modoRol) {
                    if (val === "1") modoRol = "batalla";
                    else if (val === "2") modoRol = "libre";
                    else if (val === "3") modoRol = "18";
                    else { addMessage("Por favor, elige un n√∫mero: 1, 2 o 3."); return; }
                    
                    addMessage(`üîÆ **V√≠nculo establecido.** ¬øQu√© deseas manifestar en el plano de la ${modoRol === '18' ? 'pasi√≥n' : 'realidad'}?`);
                    commandInput.value = ""; 
                    return;
                }
                
                addMessage(val, "user");
                commandInput.value = "";
                
                const respuestaIA = await llamarIA(val);
                addMessage(respuestaIA, "ai");
            }

            sendBtn.onclick = (e) => { e.preventDefault(); procesar(); };
            commandInput.onkeypress = (e) => { if (e.key === "Enter") { e.preventDefault(); procesar(); } };

            addMessage("üìñ **GRIMORIO DESPIERTO**\n\nBienvenido de nuevo, Zixtermoon. Elige tu sendero:\n1. ‚öîÔ∏è Batalla\n2. üåÄ Libre\n3. üîû +18\n\n*(Escribe 'reiniciar' para cambiar de modo)*");
        });
    </script>
</body>
</html>
